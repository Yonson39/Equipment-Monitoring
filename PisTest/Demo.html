<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <!-- <meta name=”viewport” content=”width=device-width, initial-scale=1″ /> -->
    <title>Echarts扩展_SVG2</title>
    <script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="js/esl.js"></script>
</head>
<body>
<div id="main" style="height: 1000px; width: 100%;"></div>
<script type="text/javascript">
	//屏幕大小改变自动刷新
	$(window).resize(function (){
		window.location.reload();
	});

</script>
<script type="text/javascript">
    //路径配置
    require.config({
        paths: {
            'echarts': 'js/echarts',
            'echarts/chart/map': 'js/echarts-map'
        }
    });

    //使用
    require(
        [
            'echarts',
            'echarts/chart/map'// 使用柱状图就加载bar模块，按需加载
        ],

        function (ec) {
            require('echarts/util/mapData/params').params.demo1 = {
                getGeoJson: function (callback) {
                    $.ajax({
                        url: "svg/sb1.svg",
                        dataType: 'xml',
                        success: function (xml) {
                            callback(xml)
                        }
                    });
                },
            }
            // 基于准备好的dom，初始化echarts图表
            var myChart = ec.init(document.getElementById('main'));

            var option = {
                backgroundColor:'#000066',
                title : {
                    text : '产线设备监控',
                    textStyle: {
                        color: '#009900'
                    }
                },
                tooltip : {
                    trigger: 'item',
                    //1故障，2正常，3告警，4空闲
                    formatter: function (obj) {
                        if(obj[2] == 1){
                            return obj[1]+'</br>运行正常</br>'+new Date().toLocaleTimeString();
                        }else if(obj[2] == 2){
                            return obj[1]+'</br>运行故障</br>'+new Date().toLocaleTimeString();
                        }else if(obj[2] == 3){
                            return obj[1]+'</br>运行告警</br>'+new Date().toLocaleTimeString();
                        }else if(obj[2] == 4){
                        	return obj[1]+'</br>运行空闲</br>'+new Date().toLocaleTimeString();
                        }else{
                        	return obj[1];
                        }
                        //return obj[2];
                    }
                },
                color: ['#000066'],
                legend: {
                    data: ['SBII产线'],
                    textStyle: {
                        color: '#009900'
                    }
                },
                toolbox: {
                    show : true,
                    feature : {
                        //mark : {show: true},//辅助线
                        //dataView : {show: true, readOnly: false},//数据view
                        //restore : {show: true},
                        saveAsImage : {show: true}
                    }
                },
                series : [
                	{
                		//name: '运行正常'
                        type: 'map',
                        mapType: 'demo1',
                        data: [],
                        markPoint: {
                            symbol: 'emptyCircle',
                            effect: {
                                show: true,
                                color: 'green'
                            },
                            data: []
                        }
                    },
                    {
                		//name: '运行故障'
                        type: 'map',
                        mapType: 'demo1',
                        data: [],
                        markPoint: {
                            symbol: 'emptyCircle',
                            effect: {
                                show: true,
                                color: '#FF0000 '
                            },
                            data: []
                        }
                    },
                    {
                		//name: '运行报警'
                        type: 'map',
                        mapType: 'demo1',
                        data: [],
                        markPoint: {
                            symbol: 'emptyCircle',
                            effect: {
                                show: true,
                                color: '#yellow'
                            },
                            data: []
                        }
                    },
                    {
                		//name: '运行空闲'
                        type: 'map',
                        mapType: 'demo1',
                        data: [],
                        markPoint: {
                            symbol: 'emptyCircle',
                            effect: {
                                show: true,
                                color: '#eee'
                            },
                            data: []
                        }
                    },  
                    {
                        name: 'SBII产线',
                        type: 'map',
                        mapType: 'demo1',
                        roam:true,
                        itemStyle:{
                            normal:{label:{show:true}},
                            emphasis:{label:{show:true}}
                        },
                        data: [
                            //{name:'祖明',value:2}
                        ],
                        geoCoord: {
                            '设备1': [100, 540],
                            '设备2': [160, 450],
                            '设备3': [220, 540],
                            '设备4': [280, 540],
                            '设备5': [340, 450],
                            '设备6': [400, 540],
                            '设备7': [460, 540],
                            '设备8': [520, 450],
                            '设备9': [570, 540],
                            '设备10': [630, 450],
                            '设备11': [680, 540],
                            '设备12': [740, 450],
                            '设备14': [800, 540],
                            '设备15': [850, 540],
                            '设备16': [890, 540],
                            '设备17': [930, 540],
                            '设备18': [970, 540],
                            '设备19': [1015, 540],
                            '设备20': [1055, 540],
                            '设备21': [1095, 540],
                            '设备22': [1135, 540],
                            '设备23': [120, 700],
                            '设备24': [220, 700],
                            '设备25': [330, 700],
                            '设备26': [370, 700],
                            '设备27': [415, 700],
                            '设备28': [460, 700],
                            '设备29': [505, 700],
                            '设备30': [550, 700],
                            '设备31': [595, 700],
                            '设备32': [675, 700],
                            '设备33': [740, 700],
                            '设备34': [820, 675],
                            '设备35': [890, 675]
                        },
                        markPoint : {
                            symbolSize : 1,
                            data : [
                                {name: '设备1'},
                                {name: '设备2'},
                                {name: '设备3'},
                                {name: '设备4'},
                                {name: '设备5'},
                                {name: '设备6'},
                                {name: '设备7'},
                                {name: '设备8'},
                                {name: '设备9'},
                                {name: '设备10'},
                                {name: '设备11'},
                                {name: '设备12'},
                                {name: '设备14'},
                                {name: '设备15'},
                                {name: '设备16'},
                                {name: '设备17'},
                                {name: '设备18'},
                                {name: '设备19'},
                                {name: '设备20'},
                                {name: '设备21'},
                                {name: '设备22'},
                                {name: '设备23'},
                                {name: '设备24'},
                                {name: '设备25'},
                                {name: '设备26'},
                                {name: '设备27'},
                                {name: '设备28'},
                                {name: '设备29'},
                                {name: '设备30'},
                                {name: '设备31'},
                                {name: '设备32'},
                                {name: '设备33'},
                                {name: '设备34'},
                                {name: '设备35'}                                
                            ]
                        }
                    }
                ]
            };
            //为echarts对象加载数据
            myChart.setOption(option);
            //根据抓取数据动态更新
            $.ajax({
                method: 'POST',
                url: 'demo.jsp',
                success: function(result){
                    console.info(result);
                    if(result){
                        var jsonObj = $.parseJSON(result);
                        var obj1 = [],
                        	obj2 = [],
                        	obj3 = [],
                        	obj4 = [];
                       	//console.info(jsonObj.data.length);
                       	//根据value状态重组json
                        for(var i = 0;i<jsonObj.data.length;i++){
                        	if(jsonObj.data[i].value == 1){
                        		obj1.push(jsonObj.data[i]);
                        		//console.info(JSON.stringify(obj1));
                        	}else if(jsonObj.data[i].value == 2){
                        		obj2.push(jsonObj.data[i]);
                        		console.info(JSON.stringify(obj2));
                        	}else if(jsonObj.data[i].value == 3){
                        		obj3.push(jsonObj.data[i]);
                        	}else{
                        		obj4.push(jsonObj.data[i]);
                        	}
                        }
                        
                        myChart.setOption({
                            series:[
                             {
                            	//name: '设备正常',
                                type: 'map',
                                mapType: 'demo1',
                                data: [],
                                markPoint: {
                                    symbol: 'emptyCircle',
                                    symbolSize : 10,
                                    effect: {
                                        show: true,
                                        color: 'green'},
                                    data: obj1 //json对象中的data, data为JSONArray
                                }
                             },
                             {
                             	 //name: '设备故障',
                                 type: 'map',
                                 mapType: 'demo1',
                                 data: [],
                                 markPoint: {
                                     symbol: 'emptyCircle',
                                     symbolSize : 10,
                                     effect: {
                                         show: true,
                                         color: '#FF0000 '},
                                     data: obj2 
                                 }
                              },
                              {
                          		//name: '运行报警'
                                  type: 'map',
                                  mapType: 'demo1',
                                  data: [],
                                  markPoint: {
                                      symbol: 'emptyCircle',
                                      symbolSize : 10,
                                      effect: {
                                          show: true,
                                          color: 'yellow'
                                      },
                                      data: obj3
                                  }
                              },
                              {
                          		//name: '运行空闲'
                                  type: 'map',
                                  mapType: 'demo1',
                                  data: [],
                                  markPoint: {
                                      symbol: 'emptyCircle',
                                      symbolSize : 10,
                                      effect: {
                                          show: true,
                                          color: '#eee'
                                      },
                                      data: obj4
                                  }
                              }
                            ]
                        });
                    }
                }
            });
        }
    );
</script>
</body>
</html>
